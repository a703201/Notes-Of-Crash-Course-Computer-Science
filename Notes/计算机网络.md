# 1、局域网（LAN）

第一个计算机网络出现在1950-1960年代，通常在公司或研究室内部使用，方便信息交换，称为**球鞋网络（Sneakernet）**，第二个好处在于共享物理资源，比如多台计算机可以共享一台打印机，并且早期网络也会共享存储空间，因为为每台计算机都配存储器太过昂贵。

计算机近距离构成的小型网络称为**局域网（Local Area Network，LAN）**，局域网能小到是同一间房间内的两台计算机，或者大到校园内的上千台电脑。


其中最著名和成功的局域网技术是1970年代的**以太网（Ethernet）**

# 2、媒体访问控制地址（MAC）

以太网最简单的形式是一条以太网电线连接数台计算机，当一台计算机要传数据给另一台计算机时，它以电信号形式，将数据传入电缆中，由于电缆是共享的，所以连接在同一个网络里的其他计算机都能看到数据，但是所有计算机都不知道这些数据是给自己的还是给别人的。

为了解决这个问题，以太网需要每台计算机有唯一的**媒体访问控制地址（Media Access Control Address，MAC Address）**，然后将MAC地址作为数据的前缀发送到网络中，所以计算机只需要监听以太网电缆)，只要看到自己的MAC地址，才去接收处理数据。现在制造的每台计算机都自带唯一的MAC地址，用于以太网和无线网络。

# 3、载波侦听多路访问（CSMA）

这种多台电脑共享一个传输媒介（比如上面例子中共享的以太网电线）的方法称为**载波侦听多路访问（Carrier Sense Multiple Access，CSMA）**，这里的**Carrier**指的是传输数据用的任意共享传输媒介，比如以太网的载体就是铜线，WiFi的载体就是传播无线电波的空气。许多计算机可以同时侦听相同的载体，因此使用Sense和Multiple Access。而载体传输数据的速度称为**带宽（Bandwidth）**。

但是共享载体有个很大的**弊端**：当网络流量比较小时，计算机可以等待载体清空，然后再传输他们的数据。但随着网络流量上升，两台计算机想同时写入数据的概率也会上升，这称为**冲突（Collision）**，就会使得传输的数据混乱。幸好计算机能够监听电线里的信号来检测冲突，最简单的解决方案就是看到冲突就停止传输，等待网络空闲后再试一次，问题是其他计算机也是这样打算的，其他等待的计算机可能在任何停顿间隙就闯入开始传输数据，这就导致了越来越多的冲突。

以太网的**解决方法**是：当计算机检测到冲突后，就会在重传之前等待一小段时间，并且要保证所有计算机等待时间都不相同，所以就会让计算机等待1秒叫上一个随机时间，来相互避开。

# 4、指数退避

当然这个并不能完全解决问题，还需要用到另一个技巧。如果一台计算机在传输数据期间检测到冲突，就等待1秒加上一个随机时间，但是如果再次发生冲突，就表明网络拥塞，就让计算机等待2秒加上一个随机时间，以此类推，直到成功传输。因为计算机的退避，冲突次数会大幅减少，使得数据能够再次流动起来，网络就变得顺畅了。这种指数级增加等待时间的方法称为**指数退避（Exponential Backoff）**，很多以太网和WiFi都用到这个技术。

# 5、冲突域

但是即使有了以上的技术，想用一根网线连接整个大学的计算机还是不可能的，为了减少冲突同时提高效率，我们需要减少同一载体中设备的数量，载体和其中的设备总称为**冲突域（Collision Domain）**。以之前以太网为例，一根电缆连接了6台计算机，这个称为一个冲突域。

为了减少冲突，我们可以用交换机（Switch）将它拆成两个冲突域。交换机位于两个更小的网络之间，在必要时才在两个网络之间传输数据，并且交换机会记录一个列表，写着哪个MAC地址位于哪边网络，所以当MAC A想要传数据给MAC C，交换机就不会将数据传到另一边的网络，同理如果MAC E传输数据给MAC F，交换机也不会将数据传到上面的网络，这使得两边的传输能同时进行。但是如果MAC F想传数据给A，数据就会通过交换机，使得两个网络都会被短暂占用。

即使最大型的网络——互联网（Internet）也是这样构建起来的，本质还是多个连在一起的稍小一点的网络，使得不同网络间可以传递数据。而大型网络有一个特点，从一台主机到另一台主机通常有多条线路（解决的主要问题），这就引出了另一个话题——路由（Routing）（用来选择合适路线的方法）

# 6、电路交换

连接两台相隔遥远的计算机或网络，最简单的方法是分配一条专门的通信线路，早期的电话系统就是这样运作的，这种方法称为**电路交换（Circuit Switching）**，因为是对整个电路进行修改，来连接到正确目的地，所以这种方法不灵活且价格昂贵，并且总有闲置的路线。但是好处是你可以最大限度随意使用，无需共享。因此军队、银行和其他一些机构依然会购买专门线路来连接数据中心

# 7、报文交换

传输数据的另一种方法是**报文交换（Message Switching）**，就像邮政系统一样。不像之前A和B之间有一条专有线路，这里消息会经过好几个站点，就类似于邮寄信封，信封会通过一个个中转站最终到达收件人手中，每个站点都知道下一站要发往哪里，因为站点都有自己一个**表格**，用来记录到达各个目的地，信件要如何传递。

优点：可以用不同的路由，使得通信更可靠。比如如果其中一个城市由于降雪无法接收邮件时，就能换到另一个城市继续传递数据。这里，城市就相当于网络中的路由器一样。

> 交换机是连接若干个主机的机器，用来解决冲突域问题。路由器是连接主机、路由器或交换机的机器，用来构建数据传输的线路。

信息沿着路由跳转的次数称为**跳数（Hop Count）**，通过记录跳数，可以分辨出路由问题。比如当路由A认为到达目的地最快的下一个路由是B，就将信息传递给路由B，而路由B则认为到达目的地最快的下一个路由是A，又将信息传递回给了路由A，这就使得信息在路由A和B之间踢皮球，但是这种错误可以通过在信息中实时记录的跳数来解决，如果某条信息的跳数很大，就说明路由有出问题，这个称为**跳数限制（Hop Limit）**。

缺点：当报文较大时，会堵塞网络，因为这里要求将整个报文从一个路由传到下一个路由后，才能继续传递其他报文，当传输大报文时，其他报文要么等待它传递完，要么选择另一条效率较低的路线。解决方法就是将大报文分成很多小块，称为**数据包（Packet）**。和报文交换一样，每个数据包都有网络中的目的地址，因此路由器知道要发送到哪里，这个地址的具体格式由**互联网协议（Internet Protocol，IP）**定义。每个联网的计算机都需要一个**IP地址（IP Address）**，例如`172.217.7.238`。

> MAC地址用来标识每条计算机，而IP地址是对数据包而言的。

路由器会平衡与其他路由器之间的负载，来确保传输可以快速可靠，称为**拥塞控制 （Congestion Control）**。有时候一个报文的多个数据包会经过不同线路，使得到达顺序也可能不相同，这对一些软件来说是存在问题的。幸运的是，在IP之上还有其他协议，比如TCP/IP可以解决乱序问题

# 8、分组交换

将数据拆分成多个小数据包，然后通过灵活的路由传递，非常高效且容错率高，这种方法称为**分组交换（Packet Switching）**。它的好处是可以去中心化，就没有单点失败问题。

如今全球的路由器协同工作，找出最高效的线路，用各种标准协议传输数据，比如因特网控制信息协议（Internet Control Message Protocol，ICMP）和边界网关协议（Border Gateway Protocol，BGP）
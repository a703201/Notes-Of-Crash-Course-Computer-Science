任意计算机都和一个巨大的分布式网络连接在一起，称为**互联网（Internet）**

当你在家中通过计算机观看网上视频时，你的计算机首先需要连接到局域网LAN，这个局域网是由家里WiFi路由器连接的所有设备组成的。然后家里的局域网再通过路由器连接到**广域网（Wide Area Network，WAN**），广域网的路由器一般属于你的**互联网服务提供商（Internet Service Provider，ISP）**。在广域网里，首先会有一个区域性路由器，比如覆盖你所在街区的一个路由器，然后该路由器会连接到一个更大的广域网中，比如覆盖你所在的城市，可能再跳跃几次，最终会到达互联网主干，一般由一群超大型、带宽超高的路由器组成。

> 即首先会连接到你家里的WiFi路由器构建的局域网，然后该路由器再连接到ISP提供的广域网中，该广域网是由很多层层递进的路由器构成的。

比如要从YouTube中获得视频，数据包首先会到达互联网主干，沿着主干到达对应保存该视频文件的YouTube服务器，可能这里会跳4次到达互联网主干，然后跳两次穿过互联网主干，最终再跳4次到达YouTube服务器，所以总共会跳跃10次。

我们可以通过[[Traceroute]]来看跳跃了几次：

```text
Windows上的Traceroute
1.按开始按钮
2.输入“ CMD”，然后按“ Enter”
3.在命令提示符下，键入“ tracert dftba.com”

在Mac上的Traceroute
1.点击“转到”下拉菜单
2.点击“实用程序”
3.打开终端
4.键入“ traceroute dftba.com”

Linux上的Traceroute
1.通过键入CTRL + Alt + T打开终端
2.输入：“ traceroute dftba.com”
```
# 1、互联网协议（IP）

互联网是一个巨大分布式网络，如果要发送的数据较大，分组传输就会将数据拆成一个个较小的数据包进行传输。其中数据包要想在互联网上进行传输，就要符合**互联网协议（Internet Protocol，IP）**。类似于邮寄手写信一般，每封信都需要一个地址，并且地址必须是唯一的，并且信的大小和重量也是有限制的，否则信件就无法送达。IP数据包也是如此，因为IP是一个非常底层的协议，数据包的头部只包含目标地址（IP地址），意味着当数据包到达对方电脑时，计算机不知道要把数据包交给哪个程序（比如QQ或微信），因此需要在IP之上，开发更高级的协议。

![[{3028BF6D-7EC1-4414-ABD6-DC9881A0532C}.png]]

# 2、UDP（用户数据报协议）

最简单常见的协议

UDP也有头部，位于data payload里面，在data之前。UDP头部里面包含了很多有用的信息，其中之一就是**端口号（Port Number）**，每个想访问网络的程序都要向操作系统申请一个端口号。所以当数据包到达时，接收方的操作系统会读取UDP头部里的端口号，来确定该数据包是要交给哪个软件的

![[Pasted image 20250921123730.png]]

> IP协议通过IP地址把数据包送到正确的计算机内；UDP通过数据包里的端口号送到正确的程序。

UDP不提供数据修复或数据重发机制，当接收方知道数据损坏后，一般只是丢弃这个数据包。并且当发送方使用UDP协议发送数据包时，是无法得知数据包是否到达目的地的

有些程序并不在意以上问题，因为UDP十分简单且快速。比如视频通常使用UDP协议，当数据包丢失时，也就造成视频卡顿

![[Pasted image 20250921123634.png]]



# 3、校验和（Checksum）

同时UDP的头部中还有**校验和（Checksum）**，通过对数据求和来检查数据是否正确。假设UDP数据包里原始数据是`89 111 33 32 58 41`， 最简单的计算校验和的方式就是，在发送数据包之前，计算机会把所有数据加在一起，计算出校验和364。在UDP中，校验和是以16位形式存储的，如果计算出来的和超过16位能表示的最大值，则高位数会被丢弃，只保留低位。当接收方计算机接收到这个数据包时，也会重复以上过程，如果计算出来的校验和和UDP中保存的校验和相同，代表数据是正常的，否则数据是出错的

![[{5A126E0A-6BB2-4469-B13E-7552A06639C9}.png]]

# 4、TCP（传输控制协议）

但是有些数据不能接受数据包丢失的问题，比如发送电子邮件时，所有数据必须到达，所以就需要**传输控制协议（Transmission Control Protocol，TCP）**。和UDP一样，它的头部也保存在数据之前，人们通常将IP协议和TCP协议统称为**TCP/IP协议**。TCP的头部中也包含端口号和校验和，并且TCP协议还提供更高级的功能：

1. TCP的数据包是有序号的，使得接收方可以通过这个序号将数据包排成正确顺序，即使到达时间不同。
2. TCP要求接收方的电脑收到数据包并校验和检查无误后，需要给发送方发送一个**确认码（Acknowledgement，ACK）**，代表数据包已经正确接收。当发送方接收到确认码后，就知道上一个数据包成功抵达了，发送方就会发送下一个数据包，如果这次发送方过了一段时间没有接收到确认码，则会重新发送一次。即使这里只是由于确认码延迟了，使得接收方那里有重复的数据包，但是通过序列号，可以直接删除重复的数据包

![[{A24C678A-4838-4239-AE0B-416DF8C1FED6}.png]]

并且数据包并不会一个个数据包进行传输，而是同时发送多个数据包，同时接收多个确认码，这将大大提高效率，不用浪费时间等待确认码。并且通过确认码的成功率和来回时间，我们可以推测网络的拥塞程度，TCP通过这个信息，来调整同时发包数量来解决拥塞问题

简而言之，TCP可以处理乱序和丢包问题，并且可以根据拥塞情况自动调整传输率。但是由于确认码数据包的存在，使得TCP需要传输的数据包数量翻了一倍，并且并没有传输更多信息，这对时间要求很高的程序代价太高，所以这类程序就会使用UDP协议

# 5、DNS（域名系统）

当计算机访问一个网站时，需要两个东西：IP地址（目标网站的地址）和端口号（对应于你使用的计算机浏览器）。但是通过IP地址访问网站十分不方便，所以互联网提供一个特殊服务，来将域名（Domain Name）和IP地址一一对应，称为域名系统（Dimain Name System，DNS），一般DNS服务器都是由ISP提供的。当你在浏览器中输入网站域名时，浏览器就会去访问DNS服务器，DNS就会去查表，如果域名存在，则会返回浏览器对应IP地址，然后浏览器就会给这个IP地址发送TCP请求。

因为当前域名特别多，所以DNS不会将其保存成列表形式，而是将其保存成树状结构。最顶层是[[顶级域名]]（Top Level Domain，TLD），比如`.com`和`.gov`；下一层是**[[二级域名]]（Second Level Domain）， 比如`google.com`和`dftba.com`；再下一层是子域名（Sub-domain），比如`images.google.com`等等。由于这个树结构特别大，因此这些数据分布在很多DNS服务器上，不同服务器负责树的不同部分。

![[{AEE309D0-D20C-4077-B3D4-01995B37CF71}.png]]

![[{F79ECFB1-81BE-4B8D-A2ED-7510C119756B}.png]]

# 6、OSI（开放式系统互联通信参考模型）

计算机网络分成很多层次，接下来从最底层到最高层：

1. 物理层（Physical Layer），比如线路中的电信号，以及无线网络中的无线信号
2. 数据链路层（Data Link Layer）负责操控物理层，其中包含MAC地址、冲突检测、指数回退以及其他一些底层协议
3. 网络层（Network Layer）负责各种报文交换和路由技术
4. 传输层（Transport Layer）负责在计算机之间进行点到点的传输，还会检测和修复错误，比如UDP和TCP协议
5. 会话层（Session Layer）会使用TCP和UDP来创建连接，传递信息，然后关掉连接

![[{D717FE24-3466-45A7-9616-8974B31F7287}.png]]

以上是开放式系统互联通信参考模型（Open System Interconnection model，OSI）下的5层，这个框架将网络通信划分成了很多层，每一层处理各自的问题。这种抽象可以使得分工改进多个层，而无需考虑整体复杂性。并且OSI还有额外两层：表示层（Presentation Layer）和应用层（Application Layer）